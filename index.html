
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hutz Live</title>
    <script>
      // Polyfill for BroadcastChannel in older browsers
      if (!('BroadcastChannel' in window)) {
        window.BroadcastChannel = class BroadcastChannel {
          constructor(channelName) {
            this.channelName = channelName;
            this.listeners = {};
            this._onStorageEvent = this._onStorageEvent.bind(this);
            window.addEventListener('storage', this._onStorageEvent);
          }

          _onStorageEvent(event) {
            if (event.key === this.channelName) {
              const data = JSON.parse(event.newValue || '{}');
              const e = { data };
              if (this.onmessage) this.onmessage(e);
              if (this.listeners.message) {
                this.listeners.message.forEach(callback => callback(e));
              }
            }
          }

          postMessage(message) {
            localStorage.setItem(this.channelName, JSON.stringify(message));
            localStorage.removeItem(this.channelName);
          }

          addEventListener(type, callback) {
            if (!this.listeners[type]) this.listeners[type] = [];
            this.listeners[type].push(callback);
          }

          removeEventListener(type, callback) {
            if (this.listeners[type]) {
              this.listeners[type] = this.listeners[type].filter(cb => cb !== callback);
            }
          }

          close() {
            window.removeEventListener('storage', this._onStorageEvent);
            this.listeners = {};
          }
        };
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
